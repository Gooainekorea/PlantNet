# $\color{#DD6565} ※ 현재 리팩터링진행중입니다. ※$
해당 프로젝트는 9~10월까지 학교 프로젝트의 일부로 '식물 분류 앱'으로 종료되었으나
구상 당시 스마트 테라리움 개인 프로젝트와 접목시켜 AIoT기반 식물 관리 시스템을 목표로 기획하였습니다.

# 진행 중인 작업들 입니다.
## 코드 리팩토링 및 모듈형 아키텍처 구현
- 환경 변수와 코드를 분리하고, 베이스 경로 기반의 동적 경로 할당 로직 구현해 환경에 대한 유연성을 확보할 계획입니다.
- src 디렉토리 내에 모델 학습, 전처리, 실행 진입점등 기능별로 분리되는 모듈형 아키텍처를 도입할 예정입니다.
- 단일 진입점인 main.py를 통해 전체 파이프라인을 제어하도록 구조 개선하는 것을 목표로 합니다.

## 모델 고도화
- 초기 모델로 AlexNet을 사용하여 학습했으나,  IoT/Edge 환경에 부적합 하여 최신 경량화 모델인 MobileNetV4을 도입하기로 결정했습니다.

timm라이브러리를 활용해 검증된 아키텍처(Small/Medium)를 빠르게 적용하고 전이 학습 파이프 라인을 재구축해 추론속도및 정확도를 동시에 개선하는 것을 목표로 합니다.

---
# 향후 계획
식물의 종류를 AI가 판단하고, 그 식물에 맞는 최적의 환경을 하드웨어가 자동으로 조성하는 스마트 테라리움 구현

## 기술 융합 및 서비스 확장
1. 식물 인식 및 정보 제공 소프트웨어 모듈화 (진행중)
2. 하드웨어 프로토타입 제작 
    1. MCU + Sensor (재료 구비 완료)
    2. MCU + Sensor + Cam
    3. MCU + MCU + Sensor + Cam
3. MCU 기반 엣지 영상처리 및 최적화
4. MCU 내부 경량 모델 추론 시도
5. 서버 - 기기 간 양방향 통신 및 앱 통합
7. 모바일 앱 연동 구축

### 구성
#### Home Server 
##### 하드웨어
- 삼성 노트북
##### OS
- Debian Linux
##### 기능
초기 프로토타입은 빠른 개발을 위해 Node.js와 파일 시스템 기반으로 구축되었으나, 중앙서버역할로 재구성합니다.

- AI Server
- DB Server, Data Concentrator
- Web Server
- IoT Gateway, API Gateway

##### AI 동작 시나리오
- 엣지로부터 받은 사진요청 판별 및 분석
- 시계열 데이터 기반의 생육 추이 분석 및 식물 종류 정확도 향상

#### Edge Device
##### 하드웨어 
- 골격: 다이소 피규어케이스, 다이소 고무나무 냅킨 케이스
- 센서: cds, 온습도
- 엑추에이터: led, 미니팬, 모터, 소형 초음파 가습기, OLED
- sd카드: 내부 데이터 저장
- MCU:  
    1. ESP32 mini - 프로토타입((cam(x)), 현재 보유)
    2. seeed studio xiao esp32s3 sense 2.4ghz bluetooth 5.0 듀얼코어 mcu - 프로토타입(구매예정)
    3. STM32F411RE, ST-Link(구매예정)

##### 기능
- 실시간 환경데이터 수집
- 자율 환경 제어
- 객체 탐지, 이미지 전처리
- 서버에 분석 요청
- 홈서버에 정제된 데이터 전송
- 실시간 환경을 oled에 표현

- STM: 실시간성이 중요한 센서 데이터 수집, 인터럽트처리, 엑추에이터 정밀 제어 (구현해보고싶은기능: 시간에 맞춘 조명색과 밝기제어)
- ESP: 비전처리, 외부 통신, 서버와 데이터 동기화.

##### AI 동작 시나리오
기능: 감지 및 서버에 요청

일정 시간에 한번 혹은 센서 상태 변화가 클때 인터럽트로 활성화 
- 모션감지 및 배경 변화(이전 화면과의 차이값이 크면) > 식물에 변동이 생김 > 서버에 새로운 식물 분류 요청
- 내부 AI모델로 식물 상태 판별 > 비정상 : 서버에 심화 판별 요청 / 정상: 로그 기록 및 종료
- 기준 이미지 갱신시 SD카드에 저장

# 간단한 디랙토리 구분
## 00_과정작업 정리
'식물 분류 앱'당시 과정

당시에는 버전 관리 및 문서화가 미흡했으나, 이를 계기로 Git Flow 기반의 체계적인 형상 관리를 도입하게 되었습니다.

## 3060 환경작업
주택내의 PC환경작업 과정입니다.

## PlantNet App
'식물 분류 앱'당시 배포 코드입니다.

## PlantNet ML
'식물 분류 앱'당시 코드 외에 AlexNet개선작업등이 있습니다.

## PlantNet pipeline
'식물 분류 앱'과정과 구분을 위해 따로 만든 폴더입니다. 

앞으로 진행될 모듈화 작업 코드가 올라갈 예정입니다. 

MobileNetV4작업을위한 리스트 출력등이 있습니다.

▽ 아래는 이전 Readme 부분입니다.

---

# 나도 할 수 있다! 머신러닝 학습 및 모델을 이용한 웹 어플리케이션 만들기
본 프로젝트는 크게 두 부분으로 나눠져 있습니다.

PlantNet_ML : 머신러닝 학습 프로그래밍을 구현

PlantNet_App : PlantNet_ML을 이용해 생성한 머신러닝 모델을 이용해 식물 분류 웹 어플리케이션을 구현


# 01. PlantNet_ML
예제코드 : [Olly Rennard님의 Kaggle - Pl@ntNet](https://www.kaggle.com/code/ollyrennard/pl-ntnet/notebook)

해당 머신러닝 학습 프로그래밍에서는 논문 결과의 재현 및 실현한 코드를 참고해 

어떻게 하면 더 효율적이고 안정적으로 모델을 학습 시킬 수 있을지에 초점을 맞췄습니다.

- 학습 파이프라인 최적화 및 실용적 구현
- kornia를 활용한 GPU가속 증강으로 CPU 병목 감소 (성능 및 효율성 향상)
- 클래스 불균형 해소를 위해 손실 함수에 가중치 적용
- 별도의 데이터 전처리 구현

자세한 부분은 [PlantNet_ML.md](PlantNet_ML/PlantNet_ML.md) 참고

# 02. PlantNet_App
PlantNet_ML을 이용해 생성한 머신러닝 모델을 이용해 식물 분류 웹 어플리케이션을 구현

FastAPI 를 이용해 파이썬 서버와 노드js서버 연동

웹js - 프론트엔드 동작

js서버  - 백엔드

파이썬서버 - 모델 돌리고 출력된 학명을 위키검색해 가져옴

